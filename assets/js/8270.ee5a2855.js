"use strict";(self.webpackChunkosmosis_docs=self.webpackChunkosmosis_docs||[]).push([[8270],{18270:(e,t,n)=>{n.r(t),n.d(t,{dyte_screen_share_toggle:()=>l});var r=n(94196),i=n(7147),s=n(61070),o=n(29799),a=n(76851);n(55752),n(41969);const c=()=>"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices,l=class{constructor(e){(0,r.r)(this,e),this.variant="button",this.iconPack=i.d,this.t=(0,s.u)(),this.maxScreenShareCount=-1,this.screenShareCount=0,this.screenShareEnabled=!1,this.canScreenShare=!1,this.shareScreenPermission="NOT_REQUESTED",this.selfScreenShareListener=({screenShareEnabled:e})=>{this.screenShareEnabled=e},this.screenShareListener=({screenShareEnabled:e})=>{const t=this.screenShareCount+(e?1:-1);this.screenShareCount=Math.max(t,0)},this.participantLeftListener=({screenShareEnabled:e})=>{e&&(this.screenShareCount=Math.max(this.screenShareCount-1,0))},this.selfJoinStateListener=()=>{this.updateCanProduce(this.meeting)},this.selfJoinStateRejectedListener=()=>{this.updateCanProduce(this.meeting)},this.mediaPermissionErrorListener=({kind:e,message:t})=>{"screenshare"===e&&(this.shareScreenPermission=t)},this.reachedMaxScreenShares=()=>this.maxScreenShareCount>0&&this.screenShareCount>=this.maxScreenShareCount,this.toggleScreenShare=()=>{var e;const t=null===(e=this.meeting)||void 0===e?void 0:e.self;null==t||!this.canScreenShare||this.reachedMaxScreenShares()||this.hasPermissionError()||(t.screenShareEnabled?t.disableScreenShare():t.enableScreenShare())}}connectedCallback(){c()?this.meetingChanged(this.meeting):o.l.error("[dyte-screenshare-toggle] Device does not support screensharing.")}disconnectedCallback(){var e,t,n,r,i,s,o,a,c;null===(e=this.meeting)||void 0===e||e.participants.joined.removeListener("screenShareUpdate",this.screenShareListener),null===(t=this.meeting)||void 0===t||t.participants.joined.removeListener("participantLeft",this.participantLeftListener),null===(n=this.meeting)||void 0===n||n.self.removeListener("screenShareUpdate",this.selfScreenShareListener),null===(r=this.meeting)||void 0===r||r.self.removeListener("mediaPermissionError",this.mediaPermissionErrorListener),null===(i=this.meeting)||void 0===i||i.self.removeListener("joinStageRequestAccepted",this.selfJoinStateListener),null===(s=this.meeting)||void 0===s||s.self.removeListener("joinStageRequestRejected",this.selfJoinStateRejectedListener),null===(o=this.meeting)||void 0===o||o.self.removeListener("stageJoined",this.selfJoinStateListener),null===(a=this.meeting)||void 0===a||a.self.removeListener("stageLeft",this.selfJoinStateListener),null===(c=this.meeting)||void 0===c||c.self.removeListener("removedFromStage",this.selfJoinStateListener)}meetingChanged(e){var t;if(null!=e){const n=e.self;this.canScreenShare=(0,a.c)(a.P.ScreenShare,n.permissions),this.updateCanProduce(e),this.maxScreenShareCount=(0,a.a)(e.self.permissions)?-1:null!==(t=e.self.permissions.maxScreenShareCount)&&void 0!==t?t:-1,this.screenShareEnabled=n.screenShareEnabled;let r=0;for(const t of e.participants.joined.toArray())t.screenShareEnabled&&r++;this.screenShareCount=r,e.participants.joined.addListener("screenShareUpdate",this.screenShareListener),e.participants.joined.addListener("participantLeft",this.participantLeftListener),n.addListener("screenShareUpdate",this.selfScreenShareListener),n.addListener("mediaPermissionError",this.mediaPermissionErrorListener),n.addListener("joinStageRequestAccepted",this.selfJoinStateListener),n.addListener("joinStageRequestRejected",this.selfJoinStateRejectedListener),n.addListener("stageJoined",this.selfJoinStateListener),n.addListener("stageLeft",this.selfJoinStateListener),n.addListener("removedFromStage",this.selfJoinStateListener)}}updateCanProduce(e){const{self:t,meta:n}=e,r=(0,a.c)(a.P.ScreenShare,t.permissions),i="WEBINAR"===n.viewType;if(this.canScreenShare=!1,!i&&r&&(this.canScreenShare=!0),i&&r){const e=t.permissions.canPresent,n=t.permissions.requestProduce;(e||n&&("ON_STAGE"===t.webinarStageStatus||"ACCEPTED_TO_JOIN_STAGE"===t.webinarStageStatus))&&(this.canScreenShare=!0)}}hasPermissionError(){return"SYSTEM_DENIED"===this.shareScreenPermission||"COULD_NOT_START"===this.shareScreenPermission}getState(){let e="",t="",n="",r={};const i=this.hasPermissionError(),s=this.reachedMaxScreenShares();return this.screenShareEnabled&&!i?(t=this.t("share_screen_stop"),n=this.iconPack.share_screen_stop,r["red-icon"]=!0):(t=this.t("share_screen_start"),n=this.iconPack.share_screen_start),"SYSTEM_DENIED"===this.shareScreenPermission?(e=this.t("perm_sys_denied"),r["red-icon"]=!0):e=t,s&&(e=this.t("Maximum screen share limit reached")),{tooltipLabel:e,label:t,icon:n,classList:r,showWarning:i||s}}render(){if(!c()||!this.canScreenShare)return null;const{tooltipLabel:e,label:t,icon:n,classList:i,showWarning:s}=this.getState();return(0,r.h)(r.H,{title:t},(0,r.h)("dyte-tooltip",{placement:"top",kind:"block",label:e,delay:600,part:"tooltip"},(0,r.h)("dyte-controlbar-button",{part:"controlbar-button",size:this.size,iconPack:this.iconPack,variant:this.variant,label:t,icon:n,class:i,onClick:this.toggleScreenShare,disabled:s,showWarning:s})))}static get watchers(){return{meeting:["meetingChanged"]}}};l.style=":host{display:block;font-family:var(--dyte-font-family, sans-serif)}"},61070:(e,t,n)=>{n.d(t,{g:()=>i,u:()=>s});var r=n(55752);const i=async e=>{if(null==e||"en"===e||""===e.trim())return r.d;try{const t=await fetch(`http://localhost:5000/${e}.json`);return t.ok?Object.assign({},r.d,await t.json()):r.d}catch(t){return r.d}},s=(e=r.d)=>t=>{var n;return null!==(n=e[t])&&void 0!==n?n:t}},29799:(e,t,n)=>{n.d(t,{l:()=>i});var r=n(41969),i=(0,r.c)((function(e){var t,n;t=r.a,n=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?s:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}function a(t,n){for(var i=0;i<r.length;i++){var s=r[i];this[s]=i<t?e:this.methodFactory(s,t,n)}this.log=this.debug}function c(e,n,r){return function(){typeof console!==t&&(a.call(this,n,r),this[e].apply(this,arguments))}}function l(e,t,n){return o(e)||c.apply(this,arguments)}function h(e,n,i){var s,o=this;n=null==n?"WARN":n;var c="loglevel";function h(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(i){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(i){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||l,o.getLevel=function(){return s},o.setLevel=function(n,i){if("string"==typeof n&&void 0!==o.levels[n.toUpperCase()]&&(n=o.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(s=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=n)}catch(i){}try{window.document.cookie=encodeURIComponent(c)+"="+n+";"}catch(i){}}}(n),a.call(o,n,e),typeof console===t&&n<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){n=e,h()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(n,!1),function(){if(typeof window!==t&&c){try{return void window.localStorage.removeItem(c)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var d=h();null==d&&(d=n),o.setLevel(d,!1)}var d=new h,u={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new h(e,d.getLevel(),d.methodFactory)),t};var S=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=S),d},d.getLoggers=function(){return u},d.default=d,d},e.exports?e.exports=n():t.log=n()}));i.enableAll()},76851:(e,t,n)=>{n.d(t,{P:()=>s,a:()=>r,c:()=>o,i:()=>i});const r=e=>"requestProduceVideo"in e,i=e=>!("controlBar"in e);var s;!function(e){e[e.Video=0]="Video",e[e.Audio=1]="Audio",e[e.ScreenShare=2]="ScreenShare"}(s||(s={}));const o=(e,t)=>{switch(e){case s.Video:return"ALLOWED"===(r(t)?t.produceVideo:t.produceVideo.allow);case s.Audio:return"ALLOWED"===(r(t),t.produceAudio);case s.ScreenShare:return"ALLOWED"===(r(t)?t.produceScreenshare:t.produceScreenshare.allow)}}}}]);