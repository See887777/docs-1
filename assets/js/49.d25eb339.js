(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{496:function(t,s,e){"use strict";e.r(s);var a=e(8),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"epochs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#epochs"}},[t._v("#")]),t._v(" Epochs")]),t._v(" "),e("h2",{attrs:{id:"abstract"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#abstract"}},[t._v("#")]),t._v(" Abstract")]),t._v(" "),e("p",[t._v("Often in the SDK, we would like to run certain code every-so often. The\npurpose of "),e("code",[t._v("epochs")]),t._v(" module is to allow other modules to set that they\nwould like to be signaled once every period. So another module can\nspecify it wants to execute code once a week, starting at UTC-time = x.\n"),e("code",[t._v("epochs")]),t._v(" creates a generalized epoch interface to other modules so that\nthey can easily be signalled upon such events.")]),t._v(" "),e("h2",{attrs:{id:"contents"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#contents"}},[t._v("#")]),t._v(" Contents")]),t._v(" "),e("ol",[e("li",[e("strong",[e("a",{attrs:{href:"#concepts"}},[t._v("Concept")])])]),t._v(" "),e("li",[e("strong",[e("a",{attrs:{href:"#state"}},[t._v("State")])])]),t._v(" "),e("li",[e("strong",[e("a",{attrs:{href:"#events"}},[t._v("Events")])])]),t._v(" "),e("li",[e("strong",[e("a",{attrs:{href:"#keeper"}},[t._v("Keeper")])])]),t._v(" "),e("li",[e("strong",[e("a",{attrs:{href:"#hooks"}},[t._v("Hooks")])])]),t._v(" "),e("li",[e("strong",[e("a",{attrs:{href:"#queries"}},[t._v("Queries")])])]),t._v(" "),e("li",[e("strong",[e("a",{attrs:{href:"#future-improvements"}},[t._v("Future improvements")])])])]),t._v(" "),e("h2",{attrs:{id:"concepts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#concepts"}},[t._v("#")]),t._v(" Concepts")]),t._v(" "),e("p",[t._v("The purpose of "),e("code",[t._v("epochs")]),t._v(" module is to provide generalized epoch interface\nto other modules so that they can easily implement epochs without\nkeeping own code for epochs.")]),t._v(" "),e("h2",{attrs:{id:"state"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#state"}},[t._v("#")]),t._v(" State")]),t._v(" "),e("p",[t._v("Epochs module keeps "),e("code",[t._v("EpochInfo")]),t._v(" objects and modify the information as\nepochs info changes. Epochs are initialized as part of genesis\ninitialization, and modified on begin blockers or end blockers.")]),t._v(" "),e("h3",{attrs:{id:"epoch-information-type"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#epoch-information-type"}},[t._v("#")]),t._v(" Epoch information type")]),t._v(" "),e("div",{staticClass:"language-protobuf line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-protobuf"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EpochInfo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" identifier "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("protobuf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Timestamp")]),t._v(" start_time "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdtime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nullable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("moretags"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yaml:\\"start_time\\""')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("protobuf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration")]),t._v(" duration "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nullable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdduration"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsontag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"duration,omitempty"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("moretags"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yaml:\\"duration\\""')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v(" current_epoch "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token positional-class-name class-name"}},[t._v("google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("protobuf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Timestamp")]),t._v(" current_epoch_start_time "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stdtime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nullable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gogoproto"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("moretags"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yaml:\\"current_epoch_start_time\\""')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" epoch_counting_started "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("reserved")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v(" current_epoch_start_height "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br")])]),e("p",[t._v("EpochInfo keeps "),e("code",[t._v("identifier")]),t._v(", "),e("code",[t._v("start_time")]),t._v(","),e("code",[t._v("duration")]),t._v(", "),e("code",[t._v("current_epoch")]),t._v(",\n"),e("code",[t._v("current_epoch_start_time")]),t._v(", "),e("code",[t._v("epoch_counting_started")]),t._v(",\n"),e("code",[t._v("current_epoch_start_height")]),t._v(".")]),t._v(" "),e("ol",[e("li",[e("code",[t._v("identifier")]),t._v(" keeps epoch identification string.")]),t._v(" "),e("li",[e("code",[t._v("start_time")]),t._v(" keeps epoch counting start time, if block time passes\n"),e("code",[t._v("start_time")]),t._v(", "),e("code",[t._v("epoch_counting_started")]),t._v(" is set.")]),t._v(" "),e("li",[e("code",[t._v("duration")]),t._v(" keeps target epoch duration.")]),t._v(" "),e("li",[e("code",[t._v("current_epoch")]),t._v(" keeps current active epoch number.")]),t._v(" "),e("li",[e("code",[t._v("current_epoch_start_time")]),t._v(" keeps the start time of current epoch.")]),t._v(" "),e("li",[e("code",[t._v("epoch_number")]),t._v(" is counted only when "),e("code",[t._v("epoch_counting_started")]),t._v(" flag is\nset.")]),t._v(" "),e("li",[e("code",[t._v("current_epoch_start_height")]),t._v(" keeps the start block height of current\nepoch.")])]),t._v(" "),e("h2",{attrs:{id:"events"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#events"}},[t._v("#")]),t._v(" Events")]),t._v(" "),e("p",[t._v("The "),e("code",[t._v("epochs")]),t._v(" module emits the following events:")]),t._v(" "),e("h3",{attrs:{id:"beginblocker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#beginblocker"}},[t._v("#")]),t._v(" BeginBlocker")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Attribute Key")]),t._v(" "),e("th",[t._v("Attribute Value")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("epoch_start")]),t._v(" "),e("td",[t._v("epoch_number")]),t._v(" "),e("td",[t._v("{epoch_number}")])]),t._v(" "),e("tr",[e("td",[t._v("epoch_start")]),t._v(" "),e("td",[t._v("start_time")]),t._v(" "),e("td",[t._v("{start_time}")])])])]),t._v(" "),e("h3",{attrs:{id:"endblocker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#endblocker"}},[t._v("#")]),t._v(" EndBlocker")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Type")]),t._v(" "),e("th",[t._v("Attribute Key")]),t._v(" "),e("th",[t._v("Attribute Value")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("epoch_end")]),t._v(" "),e("td",[t._v("epoch_number")]),t._v(" "),e("td",[t._v("{epoch_number}")])])])]),t._v(" "),e("h2",{attrs:{id:"keepers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#keepers"}},[t._v("#")]),t._v(" Keepers")]),t._v(" "),e("h3",{attrs:{id:"keeper-functions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#keeper-functions"}},[t._v("#")]),t._v(" Keeper functions")]),t._v(" "),e("p",[t._v("Epochs keeper module provides utility functions to manage epochs.")]),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Keeper is the interface for lockup module keeper")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Keeper "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// GetEpochInfo returns epoch info by identifier")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetEpochInfo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" identifier "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EpochInfo\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SetEpochInfo set epoch info")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetEpochInfo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" epoch types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EpochInfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DeleteEpochInfo delete epoch info")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("DeleteEpochInfo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" identifier "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// IterateEpochInfo iterate through epochs")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("IterateEpochInfo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" epochInfo types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EpochInfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stop "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Get all epoch infos")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("AllEpochInfos")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EpochInfo\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("h2",{attrs:{id:"hooks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hooks"}},[t._v("#")]),t._v(" Hooks")]),t._v(" "),e("div",{staticClass:"language-go line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// the first block whose timestamp is after the duration is counted as the end of the epoch")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("AfterEpochEnd")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" epochIdentifier "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" epochNumber "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// new epoch is next block of epoch end block")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("BeforeEpochStart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" epochIdentifier "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" epochNumber "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("h3",{attrs:{id:"how-modules-receive-hooks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#how-modules-receive-hooks"}},[t._v("#")]),t._v(" How modules receive hooks")]),t._v(" "),e("p",[t._v("On hook receiver function of other modules, they need to filter\n"),e("code",[t._v("epochIdentifier")]),t._v(" and only do executions for only specific\nepochIdentifier. Filtering epochIdentifier could be in "),e("code",[t._v("Params")]),t._v(" of other\nmodules so that they can be modified by governance. Governance can\nchange epoch from "),e("code",[t._v("week")]),t._v(" to "),e("code",[t._v("day")]),t._v(" as their need.")]),t._v(" "),e("h3",{attrs:{id:"panic-isolation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#panic-isolation"}},[t._v("#")]),t._v(" Panic isolation")]),t._v(" "),e("p",[t._v("If a given epoch hook panics, its state update is reverted, but we keep\nproceeding through the remaining hooks. This allows more advanced epoch\nlogic to be used, without concern over state machine halting, or halting\nsubsequent modules.")]),t._v(" "),e("p",[t._v('This does mean that if there is behavior you expect from a prior epoch\nhook, and that epoch hook reverted, your hook may also have an issue. So\ndo keep in mind "what if a prior hook didn\'t get executed" in the safety\nchecks you consider for a new epoch hook.')]),t._v(" "),e("h2",{attrs:{id:"queries"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#queries"}},[t._v("#")]),t._v(" Queries")]),t._v(" "),e("p",[t._v("Epochs module is providing below queries to check the module's state.")]),t._v(" "),e("div",{staticClass:"language-protobuf line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-protobuf"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("service")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// EpochInfos provide running epochInfos")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rpc")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("EpochInfos")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryEpochsInfoRequest")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryEpochsInfoResponse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// CurrentEpoch provide current epoch of specified identifier")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rpc")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("CurrentEpoch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryCurrentEpochRequest")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("returns")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("QueryCurrentEpochResponse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])]),e("h3",{attrs:{id:"epoch-infos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#epoch-infos"}},[t._v("#")]),t._v(" Epoch Infos")]),t._v(" "),e("p",[t._v("Query the currently running epochInfos")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("osmosisd query epochs epoch-infos\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("details",{staticClass:"custom-block details"},[e("summary",[t._v("Example")]),t._v(" "),e("p",[t._v("An example output:")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("epochs:\n- current_epoch: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183"')]),t._v("\n  current_epoch_start_height: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2438409"')]),t._v("\n  current_epoch_start_time: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-12-18T17:16:09.898160996Z"')]),t._v("\n  duration: 86400s\n  epoch_counting_started: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  identifier: day\n  start_time: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-06-18T17:00:00Z"')]),t._v("\n- current_epoch: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"26"')]),t._v("\n  current_epoch_start_height: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2424854"')]),t._v("\n  current_epoch_start_time: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-12-17T17:02:07.229632445Z"')]),t._v("\n  duration: 604800s\n  epoch_counting_started: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  identifier: week\n  start_time: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-06-18T17:00:00Z"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br")])])]),t._v(" "),e("h3",{attrs:{id:"current-epoch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#current-epoch"}},[t._v("#")]),t._v(" Current Epoch")]),t._v(" "),e("p",[t._v("Query the current epoch by the specified identifier")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("osmosisd query epochs current-epoch "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("identifier"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("details",{staticClass:"custom-block details"},[e("summary",[t._v("Example")]),t._v(" "),e("p",[t._v("Query the current "),e("code",[t._v("day")]),t._v(" epoch:")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("osmosisd query epochs current-epoch day\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("Which in this example outputs:")]),t._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("current_epoch: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])])]),t._v(" "),e("h2",{attrs:{id:"future-improvements"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#future-improvements"}},[t._v("#")]),t._v(" Future Improvements")]),t._v(" "),e("h3",{attrs:{id:"lack-point-using-this-module"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lack-point-using-this-module"}},[t._v("#")]),t._v(" Lack point using this module")]),t._v(" "),e("p",[t._v("In current design each epoch should be at least 2 blocks as start block\nshould be different from endblock. Because of this, each epoch time will\nbe "),e("code",[t._v("max(blocks_time x 2, epoch_duration)")]),t._v(". If epoch_duration is set to\n"),e("code",[t._v("1s")]),t._v(", and "),e("code",[t._v("block_time")]),t._v(" is "),e("code",[t._v("5s")]),t._v(", actual epoch time should be "),e("code",[t._v("10s")]),t._v(". We\ndefinitely recommend configure epoch_duration as more than 2x\nblock_time, to use this module correctly. If you enforce to set it to\n1s, it's same as 10s - could make module logic invalid.")]),t._v(" "),e("p",[t._v("TODO for postlaunch: We should see if we can architect things such that\nthe receiver doesn't have to do this filtering, and the epochs module\nwould pre-filter for them.")]),t._v(" "),e("h3",{attrs:{id:"block-time-drifts-problem"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#block-time-drifts-problem"}},[t._v("#")]),t._v(" Block-time drifts problem")]),t._v(" "),e("p",[t._v("This implementation has block time drift based on block time. For\ninstance, we have an epoch of 100 units that ends at t=100, if we have a\nblock at t=97 and a block at t=104 and t=110, this epoch ends at t=104.\nAnd new epoch start at t=110. There are time drifts here, for around 1-2\nblocks time. It will slow down epochs.")]),t._v(" "),e("p",[t._v("It's going to slow down epoch by 10-20s per week when epoch duration is\n1 week. This should be resolved after launch.")])])}),[],!1,null,null,null);s.default=n.exports}}]);